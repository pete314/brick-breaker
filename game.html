<!DOCTYPE html>
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./style/main.css" />
    </head>
    <body class="bodygame">
        <canvas id="gamecanvas"></canvas>
        
        <script src="./js/objects/brick.js"></script>
        <script src="./js/objects/ball.js"></script>
        <script type="text/javascript">
            //Init cavas
            var canvas = document.getElementById('gamecanvas');
            var ctx = canvas.getContext('2d');
            
            //resize to fit window
            ctx.canvas.width  = window.innerWidth;
            ctx.canvas.height = window.innerHeight;
            
            var bricks = new Bricks();
            bricks.init();
            var ball = new Ball(ctx, 150, 150, 10, 10, "red", 10);
            ball.draw();
            
            /*
            step();
            function step(){
              ctx.clearRect(0, 0, canvas.width, canvas.height);
              var collisions_checked = bricks.checkAllColliding(ball);
              var bricks_redrown = bricks.redrawBricks();
              ball.update();
              if(collisions_checked == true && bricks_redrown == true){
                requestAnimationFrame(step);
              }                
            }
            */
            
            
            // shim layer with setTimeout fallback
            window.requestAnimFrame = (function(){
              return  window.requestAnimationFrame       ||
                      window.webkitRequestAnimationFrame ||
                      window.mozRequestAnimationFrame    ||
                      function( callback ){
                        window.setTimeout(callback, 1000 / 60);
                      };
            })();

            (function animloop(){
              requestAnimFrame(animloop);
              render();
            })();
            
            function render(){
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ball = bricks.checkAllColliding(ball);
                var bricks_redrown = bricks.redrawBricks();
                ball.update();
            }
            
        </script>
    </body>
</html>
